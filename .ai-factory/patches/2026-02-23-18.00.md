# Client-side process filtering broken by path matching and wrong filter criteria

**Date:** 2026-02-23 18:00
**Files:** `src/routes/+page.svelte`, `src/lib/stores/filterStore.svelte.ts`
**Severity:** high

## Problem

User reported "filtering doesn't work". When searching for "yandex_browser", 
1869/4303 processes were shown — including processes named "Compositor", 
"Chrome_ChildIOT", "ThreadPoolForeg", etc. that look completely unrelated.
Checkbox filters (`Mine only`) also behaved incorrectly.

## Root Cause

Three interacting bugs in the client-side filtering logic:

1. **Search matched on executable path** — On Linux, all Chromium-based 
   browser subprocesses share the same binary path (e.g. 
   `/opt/yandex/browser/yandex_browser`). Searching "yandex_browser" matched 
   ALL subprocesses via `p.path.includes(search)`, returning ~1800 results 
   for what the user expected to be ~20 name matches. The Path column was 
   hidden by default, making the matching criterion invisible to the user.

2. **`mine_only` used `needs_elevation` instead of username** — The client-side
   filter checked `!p.needs_elevation`, which passes for processes with 
   `user: null` (kernel threads, restricted processes). The backend correctly
   compared against the actual username, making the two implementations 
   inconsistent.

3. **Threshold operator mismatch** — UI label said "CPU >" (strict greater 
   than), code used `>=` (greater than or equal). Additionally, 
   `toFilter()` skipped `cpu_gt` when value was 0 (`cpuGt > 0` check), 
   making the threshold input appear non-functional when the user deliberately
   entered 0 to filter idle processes.

## Solution

1. **Path matching gated on path separators** — Search now only matches on 
   `p.path` when the search string contains `/` or `\`, indicating the user 
   is intentionally searching by path. Name and PID matching remain default.

2. **`mine_only` adds null-user guard** — Filter now requires 
   `p.user !== null && !p.needs_elevation`, excluding processes with unknown 
   ownership.

3. **Threshold operator fixed** — Changed `>=` to strict `>` in the filter.
   Changed `toFilter()` to include threshold when `>= 0` (not just `> 0`), 
   so entering 0 correctly filters out idle processes.

## Prevention

- When a filter matches on a field that is NOT visible in the UI, the user 
  cannot understand WHY a result matched. Either always show the matched 
  field or restrict matching to visible columns.
- Client-side and server-side filters should share the same logic or the 
  client should delegate to the backend. The current dual-filter approach 
  (backend for initial load, client for live updates) creates inconsistency.
- UI labels and code operators must match exactly (`>` vs `>=`).
- Add E2E tests that assert filter output counts for known input sets.

## Tags

`#filtering` `#search` `#path-matching` `#svelte` `#client-side` `#ux`
