# "Method not allowed" in Tauri window caused by proxying localhost traffic

**Date:** 2026-02-23 16:30 (finalised 2026-02-23 16:45)  
**Files:** `src-tauri/src/lib.rs`, `vite.config.js`, `src/routes/+page.server.ts`  
**Severity:** critical (UI replaced by plain error page)

## Problem

`npm run tauri dev` started normally, but the app window rendered only:

```
Method not allowed
```

The frontend UI never loaded, even though Vite reported `ready` on `http://localhost:1420/`.

## Root Cause

Two issues interacted:

1. Linux WebKit/Tauri startup can hit the dev URL with non-standard method patterns
   (`POST` and other non-GET probes), which can lead to 405 in SvelteKit unless handled.
2. The environment had proxy variables set:
   - `HTTP_PROXY=http://127.0.0.1:8888`
   - `HTTPS_PROXY=http://127.0.0.1:8888`

Because localhost was not consistently excluded from proxying, WebKit requests for
`http://localhost:1420/` were routed through the proxy path, which returned the
`Method not allowed` body shown in the window.

## Solution

### Part A — Harden dev-server handling of WebKit startup probes

`vite.config.js` includes `webkitGtkFix()` (before `sveltekit()`), which:

- normalizes incoming URL targets (including absolute-form targets),
- rewrites non-safe methods to `GET`,
- normalizes `/index.html` to `/`.

`src/routes/+page.server.ts` keeps a fallback default action that redirects `POST /` to `GET /`.

### Part B — Enforce localhost no-proxy in Linux debug runtime (main fix)

`src-tauri/src/lib.rs` now sets `NO_PROXY` and `no_proxy` in debug Linux builds,
ensuring they include:

- `localhost`
- `127.0.0.1`
- `::1`

This is applied at app startup before WebView navigation begins.

## Verification

- Reproduced failure with normal environment (`HTTP_PROXY`/`HTTPS_PROXY` set).
- Confirmed success when launching with temporary proxy bypass:
  `HTTP_PROXY= HTTPS_PROXY= ALL_PROXY= NO_PROXY='*' no_proxy='*' npm run tauri dev`.
- After code fix, normal `npm run tauri dev` (with proxy vars still set) loaded the full UI.
- Checks passed:
  - `npm run check`
  - `cd src-tauri && cargo check`

## Prevention

- In Linux dev environments, always exclude localhost from proxying.
- Keep proxy-safe startup guard in `src-tauri/src/lib.rs` for debug builds.
- If `Method not allowed` appears with an otherwise healthy Tauri startup log,
  check proxy env vars before debugging frontend routes.

## Tags

`#tauri` `#linux` `#webkit2gtk` `#proxy` `#localhost` `#method-not-allowed`
