# Panic on startup: no Tokio reactor when spawning updater task

**Date:** 2026-02-23 14:30
**Files:** `src-tauri/src/updater/mod.rs`
**Severity:** critical

## Problem

App panicked immediately on launch with:

```
thread 'main' panicked at src/updater/mod.rs:24:5:
there is no reactor running, must be called from the context of a Tokio 1.x runtime
```

The background process updater never started; the UI had no data.

## Root Cause

`start_updater` used `tokio::spawn(...)` to launch the background task.
`tokio::spawn` requires an active Tokio reactor on the calling thread — it
must be invoked from within a `#[tokio::main]` (or equivalent) context.

Tauri's `.setup()` callback runs synchronously on the main thread *before*
Tauri's internal async runtime is fully wired up as the thread-local reactor.
Tauri provides `tauri::async_runtime::spawn` precisely to spawn tasks onto
its own managed Tokio runtime (initialized earlier and kept separate from the
thread-local reactor check that `tokio::spawn` performs).

## Solution

Replaced `tokio::spawn(async move { … })` with `tauri::async_runtime::spawn(async move { … })`.  
No other changes needed. `tokio::time` imports remain valid because Tauri's
runtime is still Tokio under the hood.

## Prevention

- In Tauri apps, **never use `tokio::spawn` directly** — always use
  `tauri::async_runtime::spawn`.
- If a function must spawn tasks and is callable outside of Tauri's setup
  (e.g. in tests), gate it with a conditional or provide a `with_runtime` wrapper.
- Code review checklist: search for bare `tokio::spawn` in `src-tauri/` and
  flag any instance not inside a `#[tokio::main]` binary entry point.
- A test that calls `start_updater` would surface this at test time rather
  than runtime.

## Tags

`#tauri` `#tokio` `#async-runtime` `#panic` `#startup`
